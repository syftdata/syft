var B=Object.defineProperty;var K=(t,e,n)=>e in t?B(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var a=(t,e,n)=>(K(t,typeof e!="symbol"?e+"":e,n),n);import{c as T,k as C,j as G,F,a as v,r as k,h as V,i as U,R as J,e as Q}from"./chunk-82eb7e4c.js";import{l as Z}from"./chunk-f83022a5.js";import{A as m,M as H,S as q}from"./chunk-8740526c.js";var P="Expected a function",Y=0/0,ee="[object Symbol]",te=/^\s+|\s+$/g,ne=/^[-+]0x[0-9a-f]+$/i,re=/^0b[01]+$/i,ie=/^0o[0-7]+$/i,oe=parseInt,se=typeof T=="object"&&T&&T.Object===Object&&T,ae=typeof self=="object"&&self&&self.Object===Object&&self,ce=se||ae||Function("return this")(),de=Object.prototype,le=de.toString,ue=Math.max,fe=Math.min,O=function(){return ce.Date.now()};function ge(t,e,n){var r,i,c,d,s,l,g=0,S=!1,h=!1,b=!0;if(typeof t!="function")throw new TypeError(P);e=X(e)||0,I(n)&&(S=!!n.leading,h="maxWait"in n,c=h?ue(X(n.maxWait)||0,e):c,b="trailing"in n?!!n.trailing:b);function w(o){var f=r,y=i;return r=i=void 0,g=o,d=t.apply(y,f),d}function u(o){return g=o,s=setTimeout(p,e),S?w(o):d}function L(o){var f=o-l,y=o-g,_=e-f;return h?fe(_,c-y):_}function E(o){var f=o-l,y=o-g;return l===void 0||f>=e||f<0||h&&y>=c}function p(){var o=O();if(E(o))return x(o);s=setTimeout(p,L(o))}function x(o){return s=void 0,b&&r?w(o):(r=i=void 0,d)}function R(){s!==void 0&&clearTimeout(s),g=0,r=l=i=s=void 0}function j(){return s===void 0?d:x(O())}function M(){var o=O(),f=E(o);if(r=arguments,i=this,l=o,f){if(s===void 0)return u(l);if(h)return s=setTimeout(p,e),w(l)}return s===void 0&&(s=setTimeout(p,e)),d}return M.cancel=R,M.flush=j,M}function he(t,e,n){var r=!0,i=!0;if(typeof t!="function")throw new TypeError(P);return I(n)&&(r="leading"in n?!!n.leading:r,i="trailing"in n?!!n.trailing:i),ge(t,e,{leading:r,maxWait:e,trailing:i})}function I(t){var e=typeof t;return!!t&&(e=="object"||e=="function")}function pe(t){return!!t&&typeof t=="object"}function me(t){return typeof t=="symbol"||pe(t)&&le.call(t)==ee}function X(t){if(typeof t=="number")return t;if(me(t))return Y;if(I(t)){var e=typeof t.valueOf=="function"?t.valueOf():t;t=I(e)?e+"":e}if(typeof t!="string")return t===0?t:+t;t=t.replace(te,"");var n=re.test(t);return n||ie.test(t)?oe(t.slice(2),n?2:8):ne.test(t)?Y:+t}var ye=he,be="Expected a function",z=0/0,we="[object Symbol]",xe=/^\s+|\s+$/g,Se=/^[-+]0x[0-9a-f]+$/i,Te=/^0b[01]+$/i,ve=/^0o[0-7]+$/i,Ee=parseInt,Me=typeof T=="object"&&T&&T.Object===Object&&T,Re=typeof self=="object"&&self&&self.Object===Object&&self,ke=Me||Re||Function("return this")(),Ae=Object.prototype,Le=Ae.toString,_e=Math.max,Ce=Math.min,$=function(){return ke.Date.now()};function Ie(t,e,n){var r,i,c,d,s,l,g=0,S=!1,h=!1,b=!0;if(typeof t!="function")throw new TypeError(be);e=N(e)||0,D(n)&&(S=!!n.leading,h="maxWait"in n,c=h?_e(N(n.maxWait)||0,e):c,b="trailing"in n?!!n.trailing:b);function w(o){var f=r,y=i;return r=i=void 0,g=o,d=t.apply(y,f),d}function u(o){return g=o,s=setTimeout(p,e),S?w(o):d}function L(o){var f=o-l,y=o-g,_=e-f;return h?Ce(_,c-y):_}function E(o){var f=o-l,y=o-g;return l===void 0||f>=e||f<0||h&&y>=c}function p(){var o=$();if(E(o))return x(o);s=setTimeout(p,L(o))}function x(o){return s=void 0,b&&r?w(o):(r=i=void 0,d)}function R(){s!==void 0&&clearTimeout(s),g=0,r=l=i=s=void 0}function j(){return s===void 0?d:x($())}function M(){var o=$(),f=E(o);if(r=arguments,i=this,l=o,f){if(s===void 0)return u(l);if(h)return s=setTimeout(p,e),w(l)}return s===void 0&&(s=setTimeout(p,e)),d}return M.cancel=R,M.flush=j,M}function D(t){var e=typeof t;return!!t&&(e=="object"||e=="function")}function je(t){return!!t&&typeof t=="object"}function Oe(t){return typeof t=="symbol"||je(t)&&Le.call(t)==we}function N(t){if(typeof t=="number")return t;if(Oe(t))return z;if(D(t)){var e=typeof t.valueOf=="function"?t.valueOf():t;t=D(e)?e+"":e}if(typeof t!="string")return t===0?t:+t;t=t.replace(xe,"");var n=Te.test(t);return n||ve.test(t)?Ee(t.slice(2),n?2:8):Se.test(t)?z:+t}var $e=Ie;function Fe(t){if(["AltGraph","Backspace","Delete"].includes(t.key)||t.key==="@"&&t.code==="KeyL")return!1;if(navigator.platform.includes("Mac")){if(t.key==="v"&&t.metaKey)return!1}else if(t.key==="v"&&t.ctrlKey||t.key==="Insert"&&t.shiftKey)return!1;if(["Shift","Control","Meta","Alt"].includes(t.key))return!1;const e=t.ctrlKey||t.altKey||t.metaKey;return!(t.key.length===1&&!e)}function A(t,e){var r;const n=e!=null?e:t.target;return{isPassword:n instanceof HTMLInputElement&&n.type.toLowerCase()==="password",type:m.Click,tagName:n.tagName,inputType:n instanceof HTMLInputElement?n.type:void 0,selectors:(r=C(n))!=null?r:{},timestamp:t.timeStamp,hasOnlyText:n.children.length===0&&n.innerText.length>0,value:void 0}}async function He(t){let e;const n=i=>{e!=null&&(e(i),e=null,window.removeEventListener("message",r))},r=i=>{if(i.data.type===H.GetSourceFileResponse)return n(i.data.data),!0};return new Promise((i,c)=>{e=i,window.addEventListener("message",r),setTimeout(()=>{n(void 0)},100),window.postMessage({type:H.GetSourceFile,data:t.selectors})})}class De{constructor({onAction:e}){a(this,"_recording");a(this,"currentEventHandleType",null);a(this,"onAction");a(this,"lastContextMenuEvent",null);a(this,"appendToRecording",e=>{this._recording.push(e),He(e).then(n=>{e.eventSource=n}).catch(n=>{console.error(n)}).finally(()=>{chrome.storage.local.set({recording:this._recording}),this.onAction(this._recording)})});a(this,"updateLastRecordedAction",e=>{const r={...this._recording[this._recording.length-1],...e};this._recording[this._recording.length-1]=r,chrome.storage.local.set({recording:this._recording}),this.onAction(this._recording)});a(this,"checkAndSetDuplicateEventHandle",e=>this.currentEventHandleType!=null?!0:(this.currentEventHandleType=e.type,setTimeout(()=>{this.currentEventHandleType=null},0),!1));a(this,"onMouseWheel",e=>{const n=this._recording[this._recording.length-1],{pageXOffset:r,pageYOffset:i}=window;if(n.type==="wheel"&&Math.sign(n.deltaX)===Math.sign(e.deltaX)&&Math.sign(n.deltaY)===Math.sign(e.deltaY))this.updateLastRecordedAction({deltaX:Math.floor(n.deltaX+e.deltaX),deltaY:Math.floor(n.deltaY+e.deltaY),pageXOffset:r,pageYOffset:i});else{const c={type:m.Wheel,deltaX:Math.floor(e.deltaX),deltaY:Math.floor(e.deltaY),pageXOffset:r,pageYOffset:i};this.appendToRecording(c)}});a(this,"onClick",e=>{if(e.isTrusted===!1||this.checkAndSetDuplicateEventHandle(e))return;const n=e.target,{parentElement:r}=n,i=(r==null?void 0:r.tagName)==="A"?r:n,c={...A(e,i),type:m.Click,offsetX:e.offsetX,offsetY:e.offsetY};this.appendToRecording(c)});a(this,"onDrag",e=>{const n=this._recording[this._recording.length-1];e.type==="dragstart"?this.appendToRecording({...A(e),type:m.DragAndDrop,sourceX:e.x,sourceY:e.y}):e.type==="drop"&&n.type===m.DragAndDrop&&this.updateLastRecordedAction({targetX:e.x,targetY:e.y})});a(this,"onKeyDown",e=>{if(!Fe(e)||this.checkAndSetDuplicateEventHandle(e))return;const n={...A(e),type:m.Keydown,key:e.key};this.appendToRecording(n)});a(this,"onContextMenu",e=>{this.lastContextMenuEvent=e});a(this,"onBackgroundMessage",e=>{var n,r;if(e!==null&&this.lastContextMenuEvent!=null){let i;switch(e.type){case"onHoverCtxMenu":i={...A(this.lastContextMenuEvent),type:m.Hover,selectors:(n=C(this.lastContextMenuEvent.target))!=null?n:{},offsetX:this.lastContextMenuEvent.offsetX,offsetY:this.lastContextMenuEvent.offsetY};break;case"onAwaitTextCtxMenu":i={...A(this.lastContextMenuEvent),type:m.AwaitText,text:e.selectionText,selectors:(r=C(this.lastContextMenuEvent.target))!=null?r:{}};break}i!=null&&this.appendToRecording(i)}});a(this,"onInput",e=>{if(this.checkAndSetDuplicateEventHandle(e))return;const n=e.target,r=C(n),i=this._recording[this._recording.length-1];if(i.type==="input"&&i.selectors.generalSelector===(r==null?void 0:r.generalSelector))this.updateLastRecordedAction({value:n==null?void 0:n.value,timestamp:e.timeStamp});else{const c={...A(e),type:m.Input,value:n==null?void 0:n.value};this.appendToRecording(c)}});a(this,"onResize",()=>{const e=this.getLastResizeAction(),{innerWidth:n,innerHeight:r}=window;if(e==null||e.width!==n||e.height!==r){const i={type:m.Resize,width:n,height:r};this.appendToRecording(i)}});a(this,"getLastResizeAction",()=>{for(let e=this._recording.length-1;e>=0;e--)if(this._recording[e].type===m.Resize)return this._recording[e]});a(this,"debouncedOnResize",$e(this.onResize,300));a(this,"onFullScreenshot",()=>{const e={type:m.FullScreenshot};this.appendToRecording(e)});this.onAction=e,this._recording=[],Z(["recording"]).then(({recording:n})=>{this._recording=n,chrome.storage.onChanged.addListener(r=>{r.recording!=null&&r.recording.newValue!=r.recording.oldValue&&(this._recording=r.recording.newValue)}),window.addEventListener("click",this.onClick,!0),window.addEventListener("contextmenu",this.onContextMenu,!0),window.addEventListener("dragstart",this.onDrag,!0),window.addEventListener("drop",this.onDrag,!0),window.addEventListener("input",this.onInput,!0),window.addEventListener("keydown",this.onKeyDown,!0),window.addEventListener("resize",this.debouncedOnResize,!0),window.addEventListener("wheel",this.onMouseWheel,!0),chrome.runtime.onMessage.addListener(this.onBackgroundMessage),this.onResize()})}deregister(){window.removeEventListener("click",this.onClick,!0),window.removeEventListener("contextmenu",this.onContextMenu,!0),window.removeEventListener("dragstart",this.onDrag,!0),window.removeEventListener("drop",this.onDrag,!0),window.removeEventListener("input",this.onInput,!0),window.removeEventListener("keydown",this.onKeyDown,!0),window.removeEventListener("resize",this.debouncedOnResize,!0),window.removeEventListener("wheel",this.onMouseWheel,!0)}}const Ye=`div#Highlighter-outline{box-sizing:border-box;pointer-events:none!important;position:fixed!important;background:#ff5d5b26!important;border:3px solid #ff5d5b!important;z-index:2147483647!important}div#Highlighter-label{pointer-events:none!important;position:fixed!important;background:#080a0b!important;color:#fff!important;padding:8px!important;font-family:monospace!important;border-radius:5px!important;z-index:2147483647!important}
`;function Xe({rect:t,displayedSelector:e}){return G(F,{children:[v("style",{children:Ye}),v("div",{id:"Highlighter-outline",style:{top:t.top,left:t.left,width:t.width,height:t.height}}),v("div",{id:"Highlighter-label",style:{top:t.top+t.height+8,left:t.left},children:e})]})}function ze(){var h,b,w;const[t,e]=k.exports.useState(null),[n,r]=k.exports.useState({}),[i,c]=k.exports.useState(!1),d=k.exports.useRef(u=>{}),s=k.exports.useRef(null),l=()=>{var u;c(!0),document.removeEventListener("mousemove",d.current,!0),e(null),(u=s.current)==null||u.deregister()};k.exports.useEffect(()=>{s.current==null&&(d.current=ye(u=>{const L=u.clientX,E=u.clientY,p=document.elementFromPoint(L,E);if(p!=null){const{parentElement:x}=p,R=(x==null?void 0:x.tagName)==="A"?x:p;e(R||null),r(C(R))}},100),document.addEventListener("mousemove",d.current,!0),s.current=new De({onAction:u=>{chrome.runtime.sendMessage({type:H.RecordedStep,data:u})}}),console.debug("[Syft][Content] Injecting the recorder listeners"),chrome.storage.onChanged.addListener(u=>{u.recordingState!=null&&u.recordingState.newValue==="finished"&&u.recordingState.newValue!==u.recordingState.oldValue&&(i||l())}))},[]);const g=t==null?void 0:t.getBoundingClientRect(),S=V({type:m.Hover,tagName:(h=t==null?void 0:t.tagName)!=null?h:"",inputType:void 0,value:void 0,selectors:n||{},timestamp:0,isPassword:!1,hasOnlyText:((b=t==null?void 0:t.children)==null?void 0:b.length)===0&&((w=t==null?void 0:t.innerText)==null?void 0:w.length)>0,offsetX:0,offsetY:0},q.Playwright);return i?v(F,{}):v(F,{children:g!=null&&g.top!=null&&v(Xe,{rect:g,displayedSelector:S!=null?S:""})})}const W=document.body.appendChild(document.createElement("DIV"));function Ne(){window.__SYFT_SCRIPT=null,Q.exports.unmountComponentAtNode(W)}window.__SYFT_CLEAN_UP=Ne;window.__SYFT_SCRIPT==null?(window.__SYFT_SCRIPT=!0,console.debug("[Syft][Content] Injecting the recorder app"),U.createRoot(W).render(v(J.StrictMode,{children:v(ze,{})}))):console.debug("[Syft][Content] Recorder app already injected");
