import{A as g}from"./chunk-8ba139f3.js";const f={WebAppUrl:"https://syft.dev"},d={WebAppUrl:"http://localhost:3000"},i=async()=>(await chrome.management.getSelf()).installType==="development"?d:f;function w(){chrome.storage.local.set({recordingState:"finished",recordingTabId:null,recordingFrameId:null,returnTabId:null})}function y(e,o,n){const t={recordingState:"active",recordingTabId:e,recordingFrameId:o,recording:[{type:"load",url:n}]};chrome.storage.local.set(t)}function S(e){chrome.storage.local.set({preferredLibrary:e})}function u(e){chrome.storage.local.set({loginSession:e})}async function p(e){return await chrome.tabs.create({url:e})}function c(e){return new Promise((o,n)=>{chrome.storage.local.get(e,t=>{o(t)})})}async function m(e,o){const n={type:g.Navigate,url:e,source:o};await h(n)}async function h(e,o){const{recording:n}=await c(["recording"]),t=[...n];t.splice(o!=null?o:t.length,0,e),await chrome.storage.local.set({recording:t})}async function b(e,o){const{recording:n}=await c(["recording"]),t=[...n];return o!=null?t.splice(e,1,o):t.splice(e,1),await chrome.storage.local.set({recording:t}),t}async function a(){const{loginSession:e}=await c(["loginSession"]);if(e)return e;const o=await i(),n=await fetch(`${o.WebAppUrl}/api/authed/extension`,{mode:"cors"});console.log("[Syft][Devtools] loginSession not found. Retrieving from server.");const t=await n.json();if(console.log("[Syft][Devtools] session",t),t!=null)return console.log("[Syft][Devtools] setting loginSession in storage"),u(t),t}let s=null;async function A(){const e=await a();if(e)return e;{const o=await i();return s&&clearInterval(s),new Promise((n,t)=>{p(o.WebAppUrl),s=setInterval(async()=>{const r=await a();r&&(n(r),s&&clearInterval(s))},1e3)})}}async function I(e,o){const n=await a();if(n&&n.session){const t=await i(),l=await(await fetch(`${t.WebAppUrl}/api/authed/file`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n.session.jwt}`},body:JSON.stringify({activeBranch:n.activeBranch,name:e,contents:o})})).json();console.log("[Syft][Devtools] saveFile response",l)}else console.error("Not logged in")}export{I as a,y as b,w as c,b as d,A as i,c as l,m as r,S as s};
