var P=Object.defineProperty;var B=(e,t,n)=>t in e?P(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var a=(e,t,n)=>(B(e,typeof t!="symbol"?t+"":t,n),n);import{e as S,i as C,j as K,F as H,a as v,r as k,f as V,h as G,R as U,c as J}from"./chunk-2d8509c2.js";import{l as Q}from"./chunk-e266c12f.js";import{A as m,M as Z,S as q}from"./chunk-8740526c.js";var N="Expected a function",Y=0/0,ee="[object Symbol]",te=/^\s+|\s+$/g,ne=/^[-+]0x[0-9a-f]+$/i,ie=/^0b[01]+$/i,re=/^0o[0-7]+$/i,oe=parseInt,se=typeof S=="object"&&S&&S.Object===Object&&S,ae=typeof self=="object"&&self&&self.Object===Object&&self,ce=se||ae||Function("return this")(),de=Object.prototype,le=de.toString,ue=Math.max,fe=Math.min,O=function(){return ce.Date.now()};function ge(e,t,n){var i,o,c,d,s,l,g=0,T=!1,h=!1,b=!0;if(typeof e!="function")throw new TypeError(N);t=F(t)||0,I(n)&&(T=!!n.leading,h="maxWait"in n,c=h?ue(F(n.maxWait)||0,t):c,b="trailing"in n?!!n.trailing:b);function w(r){var f=i,y=o;return i=o=void 0,g=r,d=e.apply(y,f),d}function u(r){return g=r,s=setTimeout(p,t),T?w(r):d}function _(r){var f=r-l,y=r-g,L=t-f;return h?fe(L,c-y):L}function E(r){var f=r-l,y=r-g;return l===void 0||f>=t||f<0||h&&y>=c}function p(){var r=O();if(E(r))return x(r);s=setTimeout(p,_(r))}function x(r){return s=void 0,b&&i?w(r):(i=o=void 0,d)}function R(){s!==void 0&&clearTimeout(s),g=0,i=l=o=s=void 0}function j(){return s===void 0?d:x(O())}function M(){var r=O(),f=E(r);if(i=arguments,o=this,l=r,f){if(s===void 0)return u(l);if(h)return s=setTimeout(p,t),w(l)}return s===void 0&&(s=setTimeout(p,t)),d}return M.cancel=R,M.flush=j,M}function he(e,t,n){var i=!0,o=!0;if(typeof e!="function")throw new TypeError(N);return I(n)&&(i="leading"in n?!!n.leading:i,o="trailing"in n?!!n.trailing:o),ge(e,t,{leading:i,maxWait:t,trailing:o})}function I(e){var t=typeof e;return!!e&&(t=="object"||t=="function")}function pe(e){return!!e&&typeof e=="object"}function me(e){return typeof e=="symbol"||pe(e)&&le.call(e)==ee}function F(e){if(typeof e=="number")return e;if(me(e))return Y;if(I(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=I(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=e.replace(te,"");var n=ie.test(e);return n||re.test(e)?oe(e.slice(2),n?2:8):ne.test(e)?Y:+e}var ye=he,be="Expected a function",X=0/0,we="[object Symbol]",xe=/^\s+|\s+$/g,Te=/^[-+]0x[0-9a-f]+$/i,Se=/^0b[01]+$/i,ve=/^0o[0-7]+$/i,Ee=parseInt,Me=typeof S=="object"&&S&&S.Object===Object&&S,Re=typeof self=="object"&&self&&self.Object===Object&&self,ke=Me||Re||Function("return this")(),Ae=Object.prototype,_e=Ae.toString,Le=Math.max,Ce=Math.min,$=function(){return ke.Date.now()};function Ie(e,t,n){var i,o,c,d,s,l,g=0,T=!1,h=!1,b=!0;if(typeof e!="function")throw new TypeError(be);t=z(t)||0,D(n)&&(T=!!n.leading,h="maxWait"in n,c=h?Le(z(n.maxWait)||0,t):c,b="trailing"in n?!!n.trailing:b);function w(r){var f=i,y=o;return i=o=void 0,g=r,d=e.apply(y,f),d}function u(r){return g=r,s=setTimeout(p,t),T?w(r):d}function _(r){var f=r-l,y=r-g,L=t-f;return h?Ce(L,c-y):L}function E(r){var f=r-l,y=r-g;return l===void 0||f>=t||f<0||h&&y>=c}function p(){var r=$();if(E(r))return x(r);s=setTimeout(p,_(r))}function x(r){return s=void 0,b&&i?w(r):(i=o=void 0,d)}function R(){s!==void 0&&clearTimeout(s),g=0,i=l=o=s=void 0}function j(){return s===void 0?d:x($())}function M(){var r=$(),f=E(r);if(i=arguments,o=this,l=r,f){if(s===void 0)return u(l);if(h)return s=setTimeout(p,t),w(l)}return s===void 0&&(s=setTimeout(p,t)),d}return M.cancel=R,M.flush=j,M}function D(e){var t=typeof e;return!!e&&(t=="object"||t=="function")}function je(e){return!!e&&typeof e=="object"}function Oe(e){return typeof e=="symbol"||je(e)&&_e.call(e)==we}function z(e){if(typeof e=="number")return e;if(Oe(e))return X;if(D(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=D(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=e.replace(xe,"");var n=Se.test(e);return n||ve.test(e)?Ee(e.slice(2),n?2:8):Te.test(e)?X:+e}var $e=Ie;function He(e){if(["AltGraph","Backspace","Delete"].includes(e.key)||e.key==="@"&&e.code==="KeyL")return!1;if(navigator.platform.includes("Mac")){if(e.key==="v"&&e.metaKey)return!1}else if(e.key==="v"&&e.ctrlKey||e.key==="Insert"&&e.shiftKey)return!1;if(["Shift","Control","Meta","Alt"].includes(e.key))return!1;const t=e.ctrlKey||e.altKey||e.metaKey;return!(e.key.length===1&&!t)}function A(e,t){var i;const n=t!=null?t:e.target;return{isPassword:n instanceof HTMLInputElement&&n.type.toLowerCase()==="password",type:m.Click,tagName:n.tagName,inputType:n instanceof HTMLInputElement?n.type:void 0,selectors:(i=C(n))!=null?i:{},timestamp:e.timeStamp,hasOnlyText:n.children.length===0&&n.innerText.length>0,value:void 0}}class De{constructor({onAction:t}){a(this,"_recording");a(this,"currentEventHandleType",null);a(this,"onAction");a(this,"lastContextMenuEvent",null);a(this,"appendToRecording",t=>{this._recording.push(t),chrome.storage.local.set({recording:this._recording}),this.onAction(this._recording)});a(this,"updateLastRecordedAction",t=>{const i={...this._recording[this._recording.length-1],...t};this._recording[this._recording.length-1]=i,chrome.storage.local.set({recording:this._recording}),this.onAction(this._recording)});a(this,"checkAndSetDuplicateEventHandle",t=>this.currentEventHandleType!=null?!0:(this.currentEventHandleType=t.type,setTimeout(()=>{this.currentEventHandleType=null},0),!1));a(this,"onMouseWheel",t=>{const n=this._recording[this._recording.length-1],{pageXOffset:i,pageYOffset:o}=window;if(n.type==="wheel"&&Math.sign(n.deltaX)===Math.sign(t.deltaX)&&Math.sign(n.deltaY)===Math.sign(t.deltaY))this.updateLastRecordedAction({deltaX:Math.floor(n.deltaX+t.deltaX),deltaY:Math.floor(n.deltaY+t.deltaY),pageXOffset:i,pageYOffset:o});else{const c={type:m.Wheel,deltaX:Math.floor(t.deltaX),deltaY:Math.floor(t.deltaY),pageXOffset:i,pageYOffset:o};this.appendToRecording(c)}});a(this,"onClick",t=>{if(t.isTrusted===!1||this.checkAndSetDuplicateEventHandle(t))return;const n=t.target,{parentElement:i}=n,o=(i==null?void 0:i.tagName)==="A"?i:n,c={...A(t,o),type:m.Click,offsetX:t.offsetX,offsetY:t.offsetY};this.appendToRecording(c)});a(this,"onDrag",t=>{const n=this._recording[this._recording.length-1];t.type==="dragstart"?this.appendToRecording({...A(t),type:m.DragAndDrop,sourceX:t.x,sourceY:t.y}):t.type==="drop"&&n.type===m.DragAndDrop&&this.updateLastRecordedAction({targetX:t.x,targetY:t.y})});a(this,"onKeyDown",t=>{if(!He(t)||this.checkAndSetDuplicateEventHandle(t))return;const n={...A(t),type:m.Keydown,key:t.key};this.appendToRecording(n)});a(this,"onContextMenu",t=>{this.lastContextMenuEvent=t});a(this,"onBackgroundMessage",t=>{var n,i;if(t!==null&&this.lastContextMenuEvent!=null){let o;switch(t.type){case"onHoverCtxMenu":o={...A(this.lastContextMenuEvent),type:m.Hover,selectors:(n=C(this.lastContextMenuEvent.target))!=null?n:{},offsetX:this.lastContextMenuEvent.offsetX,offsetY:this.lastContextMenuEvent.offsetY};break;case"onAwaitTextCtxMenu":o={...A(this.lastContextMenuEvent),type:m.AwaitText,text:t.selectionText,selectors:(i=C(this.lastContextMenuEvent.target))!=null?i:{}};break}o!=null&&this.appendToRecording(o)}});a(this,"onInput",t=>{if(this.checkAndSetDuplicateEventHandle(t))return;const n=t.target,i=C(n),o=this._recording[this._recording.length-1];if(o.type==="input"&&o.selectors.generalSelector===(i==null?void 0:i.generalSelector))this.updateLastRecordedAction({value:n==null?void 0:n.value,timestamp:t.timeStamp});else{const c={...A(t),type:m.Input,value:n==null?void 0:n.value};this.appendToRecording(c)}});a(this,"onResize",()=>{const t=this.getLastResizeAction(),{innerWidth:n,innerHeight:i}=window;if(t==null||t.width!==n||t.height!==i){const o={type:m.Resize,width:n,height:i};this.appendToRecording(o)}});a(this,"getLastResizeAction",()=>{for(let t=this._recording.length-1;t>=0;t--)if(this._recording[t].type===m.Resize)return this._recording[t]});a(this,"debouncedOnResize",$e(this.onResize,300));a(this,"onFullScreenshot",()=>{const t={type:m.FullScreenshot};this.appendToRecording(t)});this.onAction=t,this._recording=[],Q(["recording"]).then(({recording:n})=>{this._recording=n,chrome.storage.onChanged.addListener(i=>{i.recording!=null&&i.recording.newValue!=i.recording.oldValue&&(this._recording=i.recording.newValue)}),window.addEventListener("click",this.onClick,!0),window.addEventListener("contextmenu",this.onContextMenu,!0),window.addEventListener("dragstart",this.onDrag,!0),window.addEventListener("drop",this.onDrag,!0),window.addEventListener("input",this.onInput,!0),window.addEventListener("keydown",this.onKeyDown,!0),window.addEventListener("resize",this.debouncedOnResize,!0),window.addEventListener("wheel",this.onMouseWheel,!0),chrome.runtime.onMessage.addListener(this.onBackgroundMessage),this.onResize()})}deregister(){window.removeEventListener("click",this.onClick,!0),window.removeEventListener("contextmenu",this.onContextMenu,!0),window.removeEventListener("dragstart",this.onDrag,!0),window.removeEventListener("drop",this.onDrag,!0),window.removeEventListener("input",this.onInput,!0),window.removeEventListener("keydown",this.onKeyDown,!0),window.removeEventListener("resize",this.debouncedOnResize,!0),window.removeEventListener("wheel",this.onMouseWheel,!0)}}const Ye=`div#Highlighter-outline{box-sizing:border-box;pointer-events:none!important;position:fixed!important;background:#ff5d5b26!important;border:3px solid #ff5d5b!important;z-index:2147483647!important}div#Highlighter-label{pointer-events:none!important;position:fixed!important;background:#080a0b!important;color:#fff!important;padding:8px!important;font-family:monospace!important;border-radius:5px!important;z-index:2147483647!important}
`;function Fe({rect:e,displayedSelector:t}){return K(H,{children:[v("style",{children:Ye}),v("div",{id:"Highlighter-outline",style:{top:e.top,left:e.left,width:e.width,height:e.height}}),v("div",{id:"Highlighter-label",style:{top:e.top+e.height+8,left:e.left},children:t})]})}function Xe(){var h,b,w;const[e,t]=k.exports.useState(null),[n,i]=k.exports.useState({}),[o,c]=k.exports.useState(!1),d=k.exports.useRef(u=>{}),s=k.exports.useRef(null),l=()=>{var u;c(!0),document.removeEventListener("mousemove",d.current,!0),t(null),(u=s.current)==null||u.deregister()};k.exports.useEffect(()=>{s.current==null&&(d.current=ye(u=>{const _=u.clientX,E=u.clientY,p=document.elementFromPoint(_,E);if(p!=null){const{parentElement:x}=p,R=(x==null?void 0:x.tagName)==="A"?x:p;t(R||null),i(C(R))}},100),document.addEventListener("mousemove",d.current,!0),s.current=new De({onAction:u=>{chrome.runtime.sendMessage({type:Z.RecordedStep,data:u})}}),console.debug("[Syft][Content] Injecting the recorder listeners"),chrome.storage.onChanged.addListener(u=>{u.recordingState!=null&&u.recordingState.newValue==="finished"&&u.recordingState.newValue!==u.recordingState.oldValue&&(o||l())}))},[]);const g=e==null?void 0:e.getBoundingClientRect(),T=V({type:m.Hover,tagName:(h=e==null?void 0:e.tagName)!=null?h:"",inputType:void 0,value:void 0,selectors:n||{},timestamp:0,isPassword:!1,hasOnlyText:((b=e==null?void 0:e.children)==null?void 0:b.length)===0&&((w=e==null?void 0:e.innerText)==null?void 0:w.length)>0,offsetX:0,offsetY:0},q.Playwright);return o?v(H,{}):v(H,{children:g!=null&&g.top!=null&&v(Fe,{rect:g,displayedSelector:T!=null?T:""})})}const W=document.body.appendChild(document.createElement("DIV"));function ze(){window.__SYFT_SCRIPT=null,J.exports.unmountComponentAtNode(W)}window.__SYFT_CLEAN_UP=ze;window.__SYFT_SCRIPT==null?(window.__SYFT_SCRIPT=!0,console.debug("[Syft][Content] Injecting the recorder app"),G.createRoot(W).render(v(U.StrictMode,{children:v(Xe,{})}))):console.debug("[Syft][Content] Recorder app already injected");
